# Kindle: A Comprehensive Framework for Exploring  OS-Architecture Interplay in Hybrid Memory Systems
Kindle is an open-source framework based on gem5 and gemOS to explore and prototype research ideas in hybrid memory systems, crossing the hardware-software boundaries and performing comprehensive empirical evaluation.

### Building and Running Kindle
- Install Docker on your system, we used Ubuntu 20.04.3.
- Download Docker export file [kindle-container.tar.xz](https://drive.google.com/file/d/1wY7FWfpd_hKsEtvlpLf3KPNc6BnGI6d2/view?usp=sharing), size ~ 480MB
- Extract it using `xz -d kindle-container.tar.xz`
- Import extracted **kindle-container.tar** using `docker import kindle-container.tar kindle:latest`
- List the image using `docker image ls`
- Start the docker container `docker run -it --privileged kindle:latest /bin/bash`
- All steps mentioned below are to be performed inside container.
- To install "column" command run `apt-get install bsdmainutils` inside container.
- To install "expect" command run `apt-get install expect` inside container.
- To install "telnet" command run `apt-get install telnet` inside container
- Change to home directory inside the docker container `cd /home`
- Clone this git repo using `git clone --recurse-submodules https://github.com/arunkp1986/Kindle.git` inside the running container.

### Using Kindle Framework 
- Kindle framework working using a sample **quick_sort.c** program is provided in **framework** directory
- Change into **framework** directory
- `cd framework`
- Follow steps mentioned under **For framework evaluation** section of README inside to run Kindle for sample **quick_sort.c**
- The rest of the README in **framework** directory provides more information on the working of Kindle

### Evaluating of Persistent Pagetable Maintenance Schemes using Kindle
- **process_persistence** contains **rebuild** and **persistent** schemes of pagetable maintenance
- Change into **process_persistence** directory
- `cd process_persistence`
- Execute **run.sh**, it copies the **gemos.img** disk image and builds gem5
- `./run.sh`
- Execute **run_fig4_a.sh** to copy scripts and run simulation to generate output in **output** folder
- **run_fig4_a.sh** finally generates **figure_4_a.eps** plot in **output/pagetable/results**
- Compare generated **figure_4_a.eps** with expected result in **output/pagetable/expected_results**
- Similarly execute **run_fig4_b.sh** to generate **figure_4_b.eps** plot in **output/pagetable/results**
- Compare generated **run_fig4_b.sh** with expected result in **output/pagetable/expected_results**
- Execute **run_table_3.sh** generate results for **Table 3** (table_3.tsv) in  **output/pagetable/results**
- Compare generated **table_3.tsv** with expected result in **output/pagetable/expected_results** using diff command
- `diff expected_results/table_3.tsv results/table_3.tsv`  

### Evaluating of SSP use-case of Kindle
- SSP **gem5** and **gemOS** changes are present in **ssp** folder
- change into **ssp** directory
- `cd ssp`
- execute **run.sh**, it copies **data_gapbs.img.xz**, **data_sssp.img.xz**, **data_workloadb.img.xz** disk image and extract it
- **run.sh** builds gem5 with SSP changes and a vanilla version of gem5
- `./run.sh`
- Execute **run_fig5.sh** to copy scripts and run simulation to generate output in **output** folder
- **run_fig5.sh** finally generates ouput **figure_5.eps** plot in **output/results** folder
- Compare generated **figure_5.eps** with expected result in **output/expected_results**

### Evaluating of HSCC use-case of Kindle
- HSCC **gem5** and **gemOS** changes are present in **hscc** folder
- change into **hscc** directory
- `cd hscc`
- execute **run.sh**, it copies **data_gapbs.img.xz**, **data_sssp.img.xz**, **data_workloadb.img.xz** disk image and extract it
- **run.sh** builds gem5 with HSCC changes
- `./run.sh`
- Execute **run_fig6.sh** to copy scripts and run simulation to generate output in **output** folder
- **run_fig6.sh** finally generates **figure_6.eps** plot in **output/results**
- Compare generated **figure_6.eps** with expected result in **output/expected_results**
- Execute **run_table4.sh** to generate **Table 4** (table4.tsv) in  **output/results**
- Please not that execute **run_table4.sh** only after executing **run_fig6.sh**, as it used data generated by **run_fig6.sh**
- Compare generated **table4.tsv** with expected result in **output/expected_results** using diff command
- `diff expected_results/table4.tsv results/table4.tsv`  
